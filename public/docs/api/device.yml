/devices:
  get:
    summary: Return all devices filted
    tags:
    - Devices
    parameters:
    - name: query
      in: query
      description: Devices name, serial code or Os version
      schema:
        type: string
      example: pc 9

    - name: project_id
      in: query
      description: Project ID
      schema:
        type: integer
      example: 1

    - name: device_types[]
      in: query
      description: |
        List device type
        - 1 : laptop
        - 2 : pc
        - 3 : mac_mini
        - 4 : mac_book
      schema:
        collectionFormat: multi
        type: array
        items:
          type: integer
      example: [1, 2]

    - name: organization_id
      in: query
      description: Filter by organization ID of Pic
      schema:
        type: integer
      example: 1

    responses:
      200:
        description: Return all devices filted
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../schema.yml#/Device'

      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
      401:
        description: Unauthenciated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
  post:
    summary: Create device
    tags:
    - Devices
    consumes:
    - application/json
    requestBody:
      content:
        application/json:
          schema:
            properties:
              type: object
              name:
                type: string
                description: Device name
              serial_code:
                type: string
                description: Serial Code
              os_version:
                type: string
                description: Os Version
              device_type:
                type: integer
                description: Device Type
              pic_id:
                type: integer
                description: Persion In Charge ID
              project_id:
                type: integer
                description: Project ID
          example:
            name: Macbook Air 2018
            serial_code: 22243423423
            os_version: 1
            device_type: OS X 10.9
            pic_id: 1
            project_id: 2
    responses:
      201:
        description: Created Successfully
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Device'
      400:
        description: Invalid params
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              name missing:
                value:
                  error:
                    code: 400
                    message: name is missing
              project must exist:
                value:
                  error:
                    code: 400
                    message: project_id is missing
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
            examples:
              no_authorization:
                value:
                  error:
                    code: 403
                    message: unauthorized
              employee:
                value:
                  error:
                    code: 403
                    message: unauthorized
              po_other_project:
                summary: po of other project
                value:
                  error:
                    code: 403
                    message: unauthorized
      404:
        description: Device not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            example:
              error:
                code: 404
                message: Couldn't find Device with 'id'=0
      401:
        description: Unauthenciated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
/devices/{id}:
  parameters:
  - name: ID
    in: path
    schema:
      type: integer
    required: true
    description: Device ID
  get:
    summary: Show device's information
    tags:
    - Devices
    responses:
      200:
        description: return device's information
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/DeviceDetail'
            example:
              id: 1
              name: "laptop 0"
              serial_code: "546031702833217"
              device_type: "laptop"
              os_version: "Tyrell Jenkins"
              project:
                id: 3
                name: "Stanford Carroll"
                description: null
                starts_on: "2018-09-15"
                logo: "http://localhost:3000/uploads/avatar.png"
              pic:
                id: 251
                organization_id: 39
                name: "Chasity Bauch"
                employee_code: "B1210250"
                email: "chasity.bauch@framgia.com"
                birthday: nil
                phone: "0987654321"
                avatar: "/uploads/avatar.png"
              history:
                - id: 416
                  status: "pending"
                  request_type: "assign"
                  modified_date: "2018-09-26"
                  project:
                    id: 3
                    name: "Stanford Carroll"
                    description: null
                    starts_on: "2018-09-15"
                    logo: "http://localhost:3000/uploads/avatar.png"
                    request_pic:
                      id: 6,
                      organization_id: 5
                      name: "Jose Quigley I"
                      employee_code: "B1210005"
                      email: "jose.quigley.i@framgia.com"
                      birthday: null
                      phone: "0987654321"
                      avatar: "http://localhost:3000/uploads/avatar.png"
                    requester:
                      id: 251
                      organization_id: 39
                      name": "Chasity Bauch"
                      employee_code: "B1210250"
                      email: "chasity.bauch@framgia.com"
                      birthday: null
                      phone: "0987654321"
                      avatar: "http://localhost:3000/uploads/avatar.png"
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
      404:
        description: Device not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            example:
              error:
                code: 404
                message: Couldn't find Device with 'id'=0
      401:
        description: Unauthenciated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
  patch:
    summary: Update device's information
    tags:
    - Devices
    consumes:
    - application/json
    requestBody:
      content:
        application/json:
          schema:
            type: object
            name:
              type: string
              description: Device name
            os_version:
              type: string
              description: Os Version
          example:
            name: Macbook Air 2018
            os_version: OS X 10.9
    responses:
      403:
        description: "Unauthorized"
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
      404:
        description: Device not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            example:
              error:
                code: 404
                message: Couldn't find Device with 'id'=0
      200:
        description: Update device successful
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/DeviceDetail'
            example:
              id: 1
              name: "laptop 0"
              serial_code: "546031702833217"
              device_type: "laptop"
              os_version: "Tyrell Jenkins"
              project:
                id: 3
                name: "Stanford Carroll"
                description: null
                starts_on: "2018-09-15"
                logo: "http://localhost:3000/uploads/avatar.png"
              pic:
                id: 251
                organization_id: 39
                name: "Chasity Bauch"
                employee_code: "B1210250"
                email: "chasity.bauch@framgia.com"
                birthday: nil
                phone: "0987654321"
                avatar: "/uploads/avatar.png"
              history:
                - id: 416
                  status: "pending"
                  request_type: "assign"
                  modified_date: "2018-09-26"
                  project:
                      id: 3
                      name: "Stanford Carroll"
                      description: null
                      starts_on: "2018-09-15"
                      logo: "http://localhost:3000/uploads/avatar.png"
                      request_pic:
                        id: 6,
                        organization_id: 5
                        name: "Jose Quigley I"
                        employee_code: "B1210005"
                        email: "jose.quigley.i@framgia.com"
                        birthday: null
                        phone: "0987654321"
                        avatar: "http://localhost:3000/uploads/avatar.png"
                      requester:
                        id: 251
                        organization_id: 39
                        name": "Chasity Bauch"
                        employee_code: "B1210250"
                        email: "chasity.bauch@framgia.com"
                        birthday: null
                        phone: "0987654321"
                        avatar: "http://localhost:3000/uploads/avatar.png"
      401:
        description: Unauthenciated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
