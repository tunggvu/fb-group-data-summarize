/projects/{project_id}/devices/{id}/requests:
  parameters:
  - name: project_id
    in: path
    schema:
      type: interger
    required: true
    description: Project ID
  - name: ID
    in: path
    schema:
      type: interger
    required: true
    description: Device ID
  post:
    summary: Create request when change owner of device
    tags:
    - Requests
    consumes:
    - application/json
    requestBody:
      content:
        application/json:
          schema:
            type: object
            request_project:
              type: integer
              description: Project ID
            request_pic:
              type: integer
              description: Request PIC ID
          example:
            request_project: 1
            request_pic: 1
    responses:
      201:
        description: Create request successful
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Request'
            example:
              id: 417
              status: "approved"
              request_type: "assign"
              modified_date: "2018-09-27"
              project:
                id: 3
                name: "Stanford Carroll"
                description: null
                starts_on: "2018-09-15"
                logo: "http://localhost:3000/uploads/avatar.png"
              request_pic:
                id: 6
                organization_id: 5
                name: "Jose Quigley I"
                employee_code: "B1210005"
                email: "jose.quigley.i@framgia.com"
                birthday: null
                phone: "0987654321"
                avatar: "http://localhost:3000/uploads/avatar.png"
              requester:
                id: 251
                organization_id: 39
                name: "Chasity Bauch"
                employee_code: "B1210250"
                email: "chasity.bauch@framgia.com"
                birthday: null
                phone: "0987654321"
                avatar: "http://localhost:3000/uploads/avatar.png"
      400:
        description: Missing params & Can't send email
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/MissingParamsError'
            examples:
              missing_request_pic:
                value:
                  error:
                    code: 400
                    message: Employee is missing
              missing_project:
                value:
                  error:
                    code: 400
                    message: Project is missing
              cant_send_email:
                value:
                  error:
                    code: 400
                    message: Email can't be sent because of some invalid email informations
      403:
        description: "Unauthorized"
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
      404:
        description: Record not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              device_not_found:
                value:
                  error:
                    code: 404
                    message: Couldn't find Device with 'id'=0
      422:
        description: Data operation
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/DataOperationError'
            examples:
              pic_must_belong_to_project:
                value:
                  error:
                    code: 422
                    message: "Validation failed: Request PIC doesn't belongs to Request Project"
              nothing_change:
                value:
                  error:
                    code: 422
                    message: Project and PIC aren't change
              cant_create:
                value:
                  error:
                    code: 422
                    message: "Validation failed: You don't have the right to do this"
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
/requests/{id}/confirm:
  parameters:
  - name: ID
    in: path
    schema:
      type: integer
    required: true
    description: Request ID
  - name: confirmation_token
    in: query
    schema:
      type: string
    required: false
    description: confirmation_token
  get:
    summary: Update request status after requester pic accepted it
    tags:
    - Requests
    responses:
      200:
        description: request has been updated successfully
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Request'
      401:
        description: verify token is invalid or has been expired
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/InvalidEmailToken'

/requests/{id}/reject:
  parameters:
  - name: ID
    in: path
    schema:
      type: integer
    required: true
    description: Request ID
  - name: confirmation_token
    in: query
    schema:
      type: string
    required: false
    description: confirmation_token
  get:
    summary: Update request status after requester pic rejected it
    tags:
    - Requests
    responses:
      200:
        description: request has been updated successfully
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Request'
      401:
        description: verify token is invalid or has been expired
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/InvalidEmailToken'

/requests/{id}/approve:
  parameters:
  - name: ID
    in: path
    schema:
      type: integer
    required: true
    description: Request ID
  - name: confirmation_token
    in: query
    schema:
      type: string
    required: false
    description: confirmation_token
  get:
    summary: Update request status after PO approve it
    tags:
    - Requests
    responses:
      200:
        description: request has been updated successfully
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Request'
      401:
        description: verify token is invalid or has been expired
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/InvalidEmailToken'

/devices/{id}/requests:
  parameters:
  - name: ID
    in: path
    schema:
      type: interger
    required: true
    description: Device ID
  post:
    summary: Create request when borrow device. Borrower is admin or other product owner. When borrow a device of other project, a request will be created and be sent for device's PO
    tags:
    - Requests
    consumes:
    - application/json
    requestBody:
      content:
        application/json:
          schema:
            type: object
            request_project:
              type: integer
              description: Project ID
            request_pic:
              type: integer
              description: Request PIC ID
          example:
            request_project: 1
            request_pic: 1
    responses:
      201:
        description: Create request successful
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Request'
            example:
              id: 417
              status: "pending"
              request_type: "assign"
              modified_date: "2018-09-27"
              project:
                id: 3
                name: "Stanford Carroll"
                description: null
                starts_on: "2018-09-15"
                logo: "http://localhost:3000/uploads/avatar.png"
                product_owner _id: 1
              request_pic:
                id: 6
                organization_id: 5
                name: "Jose Quigley I"
                employee_code: "B1210005"
                email: "jose.quigley.i@framgia.com"
                birthday: null
                phone: "0987654321"
                avatar: "http://localhost:3000/uploads/avatar.png"
              requester:
                id: 251
                organization_id: 39
                name: "Chasity Bauch"
                employee_code: "B1210250"
                email: "chasity.bauch@framgia.com"
                birthday: null
                phone: "0987654321"
                avatar: "http://localhost:3000/uploads/avatar.png"
      400:
        description: Missing params & Can't send email
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/MissingParamsError'
            examples:
              missing_request_pic:
                value:
                  error:
                    code: 400
                    message: Employee is missing
              missing_project:
                value:
                  error:
                    code: 400
                    message: Project is missing
              cant_send_email:
                value:
                  error:
                    code: 400
                    message: Email can't be sent because of some invalid email informations
      403:
        description: "Unauthorized"
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
      404:
        description: Record not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              device_not_found:
                value:
                  error:
                    code: 404
                    message: Couldn't find Device with 'id'=0
      422:
        description: Data operation
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/DataOperationError'
            examples:
              pic_must_belong_to_project:
                value:
                  error:
                    code: 422
                    message: "Validation failed: Request PIC doesn't belongs to Request Project"
              nothing_change:
                value:
                  error:
                    code: 422
                    message: Project and PIC aren't change
              cant_borrow:
                value:
                  error:
                    code: 422
                    message: "Validation failed: You don't have the right to do this"
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
