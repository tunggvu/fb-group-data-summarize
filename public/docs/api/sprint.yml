/projects/{project_id}/phases/{phase_id}/sprints:
  parameters:
  - name: project_id
    in: path
    schema:
      type: integer
    description: Project ID
    required: true
  - name: phase_id
    in: path
    schema:
      type: integer
    description: Phase ID
    required: true
  get:
    summary: All sprint in phase
    tags:
    - Sprints
    responses:
      404:
        description: phase/project not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              project:
                value:
                  error:
                    code: 404
                    message: Couldn't find Project with 'id'=0
              phase:
                value:
                  error:
                    code: 404
                    message: Couldn't find Phase with 'id'=0
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
            examples:
              not login:
                value:
                  error:
                    code: 403
                    message: unauthorized
              employee isn't in project:
                value:
                  error:
                    code: 403
                    message: unauthorized
      200:
        description: return all sprint
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../schema.yml#/Sprint'
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
  post:
    summary: Create new sprint
    tags:
    - Sprints
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                description: Sprint's name
              starts_on:
                type: date
                description: Starts on of sprint
              ends_on:
                type: date
                description: Ends on of sprint
              efforts:
                type: array
                items:
                  type: object
                  properties:
                    effort:
                      type: integer
                      description: Effort number
                    employee_id:
                      type: integer
                      description: Employee ID
                    level_id:
                      type: integer
                      description: Level ID
                  required:
                    - effort
                    - employee_id
                    - level_id
            required:
              - name
              - starts_on
              - ends_on
              - efforts
          example:
            name: Sprint 1
            starts_on: "2018-01-01"
            ends_on: "2018-02-01"
            efforts:
              - effort: 98
                employee_id: 5
                level_id: 10
    responses:
      201:
        description: PO or PO's managers can create sprint (with or without efforts)
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/SprintMember'
            examples:
              with efforts:
                value:
                  id: 1
                  name: Sprint 1
                  starts_on: "2018-01-01"
                  ends_on: "2018-02-01"
                  members:
                    - effort: 100
                      name: Administator
                      id: 1
                      skill:
                        id: 1
                        name: Ruby
                        logo: https://cdn3.iconfinder.com/data/icons/avatars-15/64/_Ninja-2-512.png
                        level:
                          id: 3
                          name: Senior
                          rank: 3
                          logo: https://cdn3.iconfinder.com/data/icons/avatars-15/64/_Ninja-2-512.png
              without efforts:
                value:
                  id: 1
                  name: Sprint 1
                  starts_on: "2018-01-01"
                  ends_on: "2018-02-01"
      400:
        description: empty/missing params
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              missing params:
                value:
                  error:
                    code: 400
                    message: name is missing
              empty params:
                value:
                  error:
                    code: 400
                    message: name is empty
      422:
        description: invalid start time/end time
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              start time:
                value:
                  error:
                    code: 422
                    message: 'Validation failed: Starts on must be after ends on previous sprint'
              end time:
                value:
                  error:
                    code: 422
                    message: 'Validation failed: Ends on must be after starts on next sprint'
      403:
        description: employee or manager in other division cannot create sprint
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
/projects/{project_id}/phases/{phase_id}/sprints/{id}:
  parameters:
  - name: project_id
    in: path
    schema:
      type: integer
    description: Project ID
    required: true
  - name: phase_id
    in: path
    schema:
      type: integer
    description: Phase ID
    required: true
  - name: id
    in: path
    schema:
      type: integer
    description: Sprint ID
    required: true
  get:
    summary: get information specific sprint
    tags:
    - Sprints
    responses:
      404:
        description: sprint not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            example:
              error:
                code: 404
                message: Couldn't find Sprint with 'id'=0
      200:
        description: return specific sprint
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/SprintMember'
            example:
              id: 1
              name: sprint 1
              starts_on: "2018-01-01"
              ends_on: "2018-02-01"
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
            examples:
              employee not in project:
                value:
                  error:
                    code: 403
                    message: unauthorized
              not login:
                value:
                  error:
                    code: 403
                    message: unauthorized
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
  patch:
    summary: update sprint
    tags:
    - Sprints
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                description: Sprint's name
              starts_on:
                type: date
                description: Starts on of sprint
              ends_on:
                type: date
                description: Ends on of sprint
          example:
            name: sprint 3
            starts_on: "2018-01-01"
            ends_on: "2018-02-01"
    responses:
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
            examples:
              employee:
                value:
                  error:
                    code: 403
                    message: unauthorized
              manager in other division:
                value:
                  error:
                    code: 403
                    message: unauthorized
      200:
        description: PO and PO's managers can update sprint
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Sprint'
      400:
        description: empty/missing/invalid params name
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              empty params:
                value:
                  error:
                    code: 400
                    message: name is empty
              missing params:
                value:
                  error:
                    code: 400
                    message: name is missing
              invalid date:
                value:
                  error:
                    code: 400
                    message: starts_on is invalid
      422:
        description: invalid ends on after starts on of next sprint
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            examples:
              starts on after ends on:
                value:
                  error:
                    code: 422
                    message: "Validation failed: Ends on must be after the starts on"
              starts on before ends on of previous sprint:
                value:
                  error:
                    code: 422
                    message: "Validation failed: Starts on must be after ends on previous sprint"
              time sprint not in time phase:
                value:
                  error:
                    code: 422
                    message: "Validation failed: Sprint time must be in phase time"
              ends on after starts on of next sprin:
                value:
                  error:
                    code: 422
                    message: "Validation failed: Ends on must be after starts on next sprint"
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
  delete:
    summary: Delete sprint
    tags:
    - Sprints
    responses:
      200:
        description: PO and managers of PO can delete sprint
        content:
          appication/json:
            schema:
              $ref: '../schema.yml#/SuccessMessage'
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
            examples:
              employee:
                value:
                  error:
                    code: 403
                    message: unauthorized
              manager of other div:
                value:
                  error:
                    code: 403
                    message: unauthorized
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
/sprints/{id}/employees:
  parameters:
  - name: id
    in: path
    schema:
      type: integer
    description: Sprints ID
    required: true
    example: 1
  get:
    summary: Get employee offort information specific sprint
    tags:
    - Sprints
    responses:
      200:
        description: return specific sprint
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../schema.yml#/EmployeeLevel'
      403:
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthorizedError'
            examples:
              employee not in project and can't view:
                value:
                  error:
                    code: 403
                    message: unauthorized
              not login:
                value:
                  error:
                    code: 403
                    message: unauthorized
      404:
        description: sprint not found
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/Error'
            example:
              error:
                code: 404
                message: Couldn't find Sprint with 'id'=0
      401:
        description: Unauthenticated
        content:
          application/json:
            schema:
              $ref: '../schema.yml#/UnauthenticatedError'
